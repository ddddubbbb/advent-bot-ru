Technical Specification ¬´Advent Bot RU¬ª
## –¢–ó: —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–æ—Ç–∞ ¬´Advent Bot RU¬ª

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Telegram‚Äë–±–æ—Ç –¥–ª—è —Å–µ–º–µ–π —Å –¥–µ—Ç—å–º–∏: –≤—ã–¥–∞—ë—Ç –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–µ –∞–¥–≤–µ–Ω—Ç‚Äë–∑–∞–¥–∞–Ω–∏—è –¥–µ—Ç—è–º —Å —É—á—ë—Ç–æ–º –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ –¥–Ω—è, –≤–µ–¥—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π –Ω–∞ –æ–¥–Ω–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è –∏ –ø–ª–∞—Ç–Ω—ã–µ —Ñ–∏—á–∏ —á–µ—Ä–µ–∑ Telegram Stars.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (—Ä–æ–¥–∏—Ç–µ–ª—å)** ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü –±–æ—Ç–∞.

**–†–µ–±—ë–Ω–æ–∫:**
- `id`, `parent_id`
- `name`
- `age`
- `tz_label` (—á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ—è—Å–∞)
- `tz_offset` (—Å–º–µ—â–µ–Ω–∏–µ –≤ —á–∞—Å–∞—Ö –æ—Ç UTC)

**–ó–∞–ø–∏—Å—å –∑–∞–¥–∞–Ω–∏—è:**
- `id` (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π id –∑–∞–ø–∏—Å–∏)
- `child_id`
- `year`, `month`, `day`
- `task_id` (id –∑–∞–¥–∞–Ω–∏—è –∏–∑ `tasks_ru.json`)
- `status` (`"new"` / `"done"`)

–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `data/storage.json`.

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π

1. –†–æ–¥–∏—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ (`/start`).
2. –î–æ–±–∞–≤–ª—è–µ—Ç –¥–µ—Ç–µ–π —á–µ—Ä–µ–∑ –º–µ–Ω—é ¬´üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ú–æ–∏ –¥–µ—Ç–∏¬ª.
3. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–µ–∫–∞–±—Ä—è –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è:
   - ¬´üìÖ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è¬ª ‚Äî –≤—ã–±–æ—Ä —Ä–µ–±—ë–Ω–∫–∞ (–µ—Å–ª–∏ –∏—Ö >1), –≤—ã–¥–∞—á–∞ –∑–∞–¥–∞–Ω–∏—è.
   - ¬´‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ¬ª ‚Äî –≤—ã–±–æ—Ä —Ä–µ–±—ë–Ω–∫–∞, –æ—Ç–º–µ—Ç–∫–∞ –∑–∞–¥–∞–Ω–∏—è –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ.
4. –ú–æ–∂–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
   - ¬´üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª ‚Äî –≤—ã–±–æ—Ä —Ä–µ–±—ë–Ω–∫–∞, –≤—ã–≤–æ–¥ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ü–∏—Ñ—Ä –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü.
5. –ú–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–ª–∞—Ç–Ω—ã–º–∏ —Ñ–∏—á–∞–º–∏:
   - ¬´üéÖ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω¬ª ‚Üí reroll, –∫–∞–ª–µ–Ω–¥–∞—Ä—å, –¥–æ–Ω–∞—Ç—ã.
6. –ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä—É –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å:
   - ¬´‚úâ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å¬ª ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ —É–ª–µ—Ç–∞–µ—Ç –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π feedback‚Äë—á–∞—Ç.

---

### –ú–µ–Ω—é –∏ –∫–æ–º–∞–Ω–¥—ã

#### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

- üìÖ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è  
- üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ú–æ–∏ –¥–µ—Ç–∏  
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞  
- üéÖ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω  
- ‚úâ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å  

#### –ú–æ–∏ –¥–µ—Ç–∏

–≠–∫—Ä–∞–Ω ¬´üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ú–æ–∏ –¥–µ—Ç–∏¬ª:

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ—Ö –¥–µ—Ç–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ¬´–ò–º—è, –≤–æ–∑—Ä–∞—Å—Ç, TZ¬ª.

–ö–Ω–æ–ø–∫–∏:
- ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–±—ë–Ω–∫–∞  
- üóë –£–¥–∞–ª–∏—Ç—å  
- ‚¨Ö –í –º–µ–Ω—é  

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–±—ë–Ω–∫–∞:
1. –í–≤–æ–¥ –∏–º–µ–Ω–∏.  
2. –í–≤–æ–¥ –≤–æ–∑—Ä–∞—Å—Ç–∞ (0‚Äì99).  
3. –í—ã–±–æ—Ä —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –∏–∑ —Å–ø–∏—Å–∫–∞.  
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `storage.json`.

–£–¥–∞–ª–µ–Ω–∏–µ:
1. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ `üóë –£–¥–∞–ª–∏—Ç—å` ‚Äî —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω –¥–µ—Ç–µ–π.  
2. –í—ã–±–æ—Ä –∏–º–µ–Ω–∏ ‚Üí –≤—ã–∑–æ–≤ `storage.delete_child(child_id)`:
   - –∑–∞–ø–∏—Å—å —Ä–µ–±—ë–Ω–∫–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ `children`;
   - –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∑–∞–¥–∞–Ω–∏–π (`tasks`) –ø–æ —ç—Ç–æ–º—É `child_id` —É–¥–∞–ª—è—é—Ç—Å—è.

---

### –õ–æ–≥–∏–∫–∞ –¥–∞—Ç / –¥–µ–∫–∞–±—Ä—è

- –ë–æ—Ç –≤—ã–¥–∞—ë—Ç –∑–∞–¥–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ –¥–µ–∫–∞–±—Ä–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ `is_december(date)`).
- –õ–æ–∫–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ —Ä–µ–±—ë–Ω–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ `UTC + tz_offset`.
- –î–ª—è –≤—ã–¥–∞—á–∏/—Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞–Ω–∏—è –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ —Ä–µ–±—ë–Ω–∫–∞.

---

### –ó–∞–¥–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

–ö–Ω–æ–ø–∫–∞ `üìÖ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è`:

1. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–µ—Ç–∏ —Ä–æ–¥–∏—Ç–µ–ª—è.
2. –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ—Ç–µ–π ‚Üí –ø—Ä–æ—Å—å–±–∞ —Å–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–∏—Ç—å.
3. –ï—Å–ª–∏ 1 —Ä–µ–±—ë–Ω–æ–∫ ‚Üí —Å—Ä–∞–∑—É `send_today_task(child)`.
4. –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí FSM‚Äë—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ä–µ–±—ë–Ω–∫–∞:
   - –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∏–º–µ–Ω–∞–º–∏ –¥–µ—Ç–µ–π + `‚¨Ö –í –º–µ–Ω—é`;
   - –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ ‚Üí `send_today_task(child)`.

`send_today_task`:

1. –ë–µ—Ä—ë—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞ —Ä–µ–±—ë–Ω–∫–∞.
2. –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –¥–µ–∫–∞–±—Ä—å ‚Äî –¥—Ä—É–∂–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≤—ã—Ö–æ–¥.
3. –ò—â–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –∑–∞–¥–∞–Ω–∏—è —á–µ—Ä–µ–∑ `storage.get_task_record(child_id, y, m, d)`:
   - –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å –∏ `status == "done"`:
     - –±–æ—Ç –ø–∏—à–µ—Ç: ¬´–ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ –∑–∞–≤—Ç—Ä–∞¬ª;
   - –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å –∏ `status != "done"`:
     - –±–µ—Ä—ë—Ç—Å—è —Ç–µ–∫—Å—Ç –∏–∑ `tasks_ru.json` –ø–æ `task_id` –∏ —Å–Ω–æ–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞–¥–∞–Ω–∏–µ;
   - –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç:
     - –ø–æ–¥–±–∏—Ä–∞–µ—Ç—Å—è –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `pick_task(child, date, storage, child_id)`;
     - —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ `add_task_record(..., status="new")`;
     - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞–¥–∞–Ω–∏–µ.
4. –¢–µ–∫—Å—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –∏–º—è —Ä–µ–±—ë–Ω–∫–∞ –∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Å –∫–ª–∞–≤–æ–π `today_task_keyboard`:
   - ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ  
   - ‚¨Ö –í –º–µ–Ω—é  

---

### –û—Ç–º–µ—Ç–∫–∞ ¬´–í—ã–ø–æ–ª–Ω–µ–Ω–æ¬ª

–ö–Ω–æ–ø–∫–∞ `‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ`:

1. –ï—Å–ª–∏ –¥–µ—Ç–µ–π –Ω–µ—Ç ‚Üí –ø—Ä–æ—Å—å–±–∞ –¥–æ–±–∞–≤–∏—Ç—å.
2. –ï—Å–ª–∏ –æ–¥–∏–Ω —Ä–µ–±—ë–Ω–æ–∫ ‚Üí `mark_done_for_child(child)`.
3. –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí FSM‚Äë—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ä–µ–±—ë–Ω–∫–∞, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∏–º–µ–Ω–∞–º–∏.

`mark_done_for_child`:

1. –ë–µ—Ä—ë—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –¥–∞—Ç—É —Ä–µ–±—ë–Ω–∫–∞.
2. –ò—â–µ—Ç –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ `get_task_record`.
3. –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç:
   - —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–£ —Ä–µ–±—ë–Ω–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è, –Ω–∞–∂–º–∏—Ç–µ "üìÖ –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"¬ª.
4. –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å:
   - `storage.set_task_status(..., "done")`;
   - —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ¬ª.

---

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–ö–Ω–æ–ø–∫–∞ `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞`:

- –ï—Å–ª–∏ –¥–µ—Ç–µ–π –Ω–µ—Ç ‚Üí –ø—Ä–æ—Å—å–±–∞ –¥–æ–±–∞–≤–∏—Ç—å.
- –ï—Å–ª–∏ –æ–¥–∏–Ω —Ä–µ–±—ë–Ω–æ–∫:
  - –±–µ—Ä—ë—Ç—Å—è —Ç–µ–∫—É—â–∏–π –≥–æ–¥/–º–µ—Å—è—Ü;
  - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `build_stats_text(child, year, month)` –∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç.
- –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí FSM‚Äë—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ä–µ–±—ë–Ω–∫–∞, –∑–∞—Ç–µ–º `build_stats_text` –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ.

`build_stats_text(child, year, month)`:

- `records = storage.get_task_records_for_child(child_id, year, month)`.  
- `total = len(records)`.  
- `done = count(status == "done")`.  
- `in_progress = total - done`.  
- –¢–µ–∫—Å—Ç: ¬´–í—Å–µ–≥–æ –≤—ã–¥–∞–Ω–æ / –≤—ã–ø–æ–ª–Ω–µ–Ω–æ / –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ¬ª.

---

### –ü–ª–∞—Ç–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (Stars)

–ö–Ω–æ–ø–∫–∞ `üéÖ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω`:

–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:
- üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ ‚≠ê50  
- üì• –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ –º–µ—Å—è—Ü ‚≠ê100  
- üôè –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç  
- ‚¨Ö –í –º–µ–Ω—é  

#### –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ (reroll, 50 Stars)

–ö–Ω–æ–ø–∫–∞: `üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ ‚≠ê50`.

1. –ï—Å–ª–∏ –¥–µ—Ç–µ–π –Ω–µ—Ç ‚Üí –ø—Ä–æ—Å—å–±–∞ –¥–æ–±–∞–≤–∏—Ç—å.
2. –ï—Å–ª–∏ 1 —Ä–µ–±—ë–Ω–æ–∫ ‚Üí —Å—Ä–∞–∑—É `send_reroll_invoice(child)`.
3. –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí FSM‚Äë—Å–æ—Å—Ç–æ—è–Ω–∏–µ `waiting_child_for_reroll`, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∏–º–µ–Ω–∞–º–∏:
   - –≤—ã–±–æ—Ä –∏–º–µ–Ω–∏ ‚Üí `send_reroll_invoice(child)`.

`send_reroll_invoice`:

- –§–æ—Ä–º–∏—Ä—É–µ—Ç payload `reload_task_{child_id}_{YYYYMMDD}` (–ø–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç–µ).
- –®–ª—ë—Ç Stars‚Äë–∏–Ω–≤–æ–π—Å –Ω–∞ 50.

–í `successful_payment_callback`:

- –ï—Å–ª–∏ payload –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `reload_task_`:
  - –ø–∞—Ä—Å–∏—Ç `child_id` –∏ –¥–∞—Ç—É;
  - –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–±—ë–Ω–∫–∞;
  - —á–µ—Ä–µ–∑ `pick_task(...)` –ø–æ–¥–±–∏—Ä–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ (—É—á–∏—Ç—ã–≤–∞–µ—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ id);
  - –≤—ã–∑—ã–≤–∞–µ—Ç `storage.update_task_id(...)`:
    - –º–µ–Ω—è–µ—Ç `task_id` –Ω–∞ –Ω–æ–≤—ã–π –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `status` –≤ `"new"`;
  - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é –∑–∞ 50 Stars.

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:

- –î–µ–Ω—å –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–µ–º –∂–µ (`year/month/day`), –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ–Ω—è–ª—Å—è `task_id`, —Å—Ç–∞—Ç—É—Å —Å–Ω–æ–≤–∞ `new` ‚Üí —Å—á—ë—Ç—á–∏–∫–∏ ¬´–≤—ã–¥–∞–Ω–æ/–≤—ã–ø–æ–ª–Ω–µ–Ω–æ¬ª –Ω–µ –ª–æ–º–∞—é—Ç—Å—è.

#### –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ –º–µ—Å—è—Ü (100 Stars)

–ö–Ω–æ–ø–∫–∞: `üì• –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ –º–µ—Å—è—Ü ‚≠ê100`.

1. –ï—Å–ª–∏ –¥–µ—Ç–µ–π –Ω–µ—Ç ‚Üí –ø—Ä–æ—Å—å–±–∞ –¥–æ–±–∞–≤–∏—Ç—å.
2. –ï—Å–ª–∏ 1 —Ä–µ–±—ë–Ω–æ–∫ ‚Üí `send_full_calendar_invoice(child)`.
3. –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Üí FSM‚Äë—Å–æ—Å—Ç–æ—è–Ω–∏–µ `waiting_child_for_calendar`, –≤—ã–±–æ—Ä –∏–º–µ–Ω–∏, –∑–∞—Ç–µ–º `send_full_calendar_invoice(child)`.

`send_full_calendar_invoice`:

- Payload: `full_calendar_{child_id}_{year}` (–≥–æ–¥ ‚Äî —Ç–µ–∫—É—â–∏–π).
- Stars‚Äë–∏–Ω–≤–æ–π—Å –Ω–∞ 100.
- –í –∫–æ–¥–µ –µ—Å—Ç—å DEBUG‚Äë–±–ª–æ–∫ –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
  - –º–æ–∂–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `answer_invoice` –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `handle_full_calendar_free(...)`.

`handle_full_calendar_free(message, child_id, year)`:

- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è 1‚Äì31 –¥–µ–∫–∞–±—Ä—è:
  - –∏—â–µ—Ç –∑–∞–ø–∏—Å—å –∑–∞–¥–∞–Ω–∏—è;
  - –µ—Å–ª–∏ –∑–∞–ø–∏—Å–∏ –Ω–µ—Ç ‚Äî –ø–æ–¥–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á—É `pick_task(...)` –∏ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å;
- –°–æ–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—è:
  - –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞: `day. —Å—Ç–∞—Ç—É—Å (‚úÖ/‚è≥) —Ç–µ–∫—Å—Ç_–∑–∞–¥–∞–Ω–∏—è_—Å_–∏–º–µ–Ω–µ–º`.
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –±–æ–ª—å—à–æ–π —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `successful_payment_callback` –ø—Ä–∏ payload `full_calendar_...`.

#### –î–æ–Ω–∞—Ç—ã (200 / 500 / 1000 Stars)

–ö–Ω–æ–ø–∫–∞: `üôè –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç`:

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É:
  - ‚≠ê 200 Stars  
  - ‚≠ê 500 Stars  
  - ‚≠ê 1000 Stars  
  - ‚¨Ö –í –º–µ–Ω—é  

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–∞–∫–µ—Ç–∞:

- –ü–∞—Ä—Å–∏—Ç —Å—É–º–º—É (200/500/1000).
- –®–ª—ë—Ç Stars‚Äë–∏–Ω–≤–æ–π—Å –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—É–º–º—É (`donation_{amount}`).

–í `successful_payment_callback`:

- Payload `donation_XXX` ‚Üí —Å–ø–∞—Å–∏–±–æ‚Äë—Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Å—É–º–º–æ–π.

---

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

–ö–Ω–æ–ø–∫–∞ `‚úâ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å`:

1. –ë–æ—Ç –ø–∏—à–µ—Ç: ¬´–ù–∞–ø–∏—à–∏ –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–æ–π‚Ä¶¬ª.
2. –°–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–º:
   - —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –≤–∏–¥–∞:
     - ¬´–û—Ç @username (id=...)¬ª + —Ç–µ–∫—Å—Ç;
   - —à–ª—ë—Ç –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª/–≥—Ä—É–ø–ø—É —Å `FEEDBACK_CHAT_ID`;
   - –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ¬´–°–ø–∞—Å–∏–±–æ, —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–æ¬ª.

–ì—Ä—É–ø–ø–∞/–∫–∞–Ω–∞–ª –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, –±–æ—Ç–∞ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —É—á–∞—Å—Ç–Ω–∏–∫–∏.
